(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[0],{31:function(e,t,n){e.exports=n(53)},36:function(e,t,n){},37:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},41:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=41},42:function(e,t,n){},43:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(23),o=n.n(c),i=(n(36),n(24)),u=n(25),s=n(27),l=n(28),d=(n(37),n(3)),f=a.a.memo((function(e){var t=e.err,n=Object(r.useState)(30),c=Object(d.a)(n,2),o=c[0],i=c[1];return Object(r.useEffect)((function(){o>0?setTimeout((function(){i(o-1)}),1e3):window.location.reload()})),a.a.createElement("div",null,a.a.createElement("h1",null,"Unrecoverable error occurred."),t&&a.a.createElement("h6",null,t.name,": ",t.message),a.a.createElement("p",null,"Will auto reload in ",o," sec."))})),m=n(2),p=n.n(m),v=n(4),b=(n(39),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=window.crypto.getRandomValues(new Uint8Array(e)),n=Array.from(t),r=n.map((function(e){return e.toString(16).padStart(2,"0")})).join("");return r}),h=function(){return 1e3+window.crypto.getRandomValues(new Uint16Array(1))[0]%9e3},g=function(){var e=Object(v.a)(p.a.mark((function e(){var t,n,r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("raw",t);case 5:return n=e.sent,r=Array.from(new Uint8Array(n)),a=r.map((function(e){return e.toString(16).padStart(2,"0")})).join(""),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r,a,c,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.length/2,a=new Uint8Array(r),c=0;c<r;c+=1)a[c]=parseInt(t.slice(2*c,2*c+2),16);return e.next=5,window.crypto.subtle.importKey("raw",a,{name:"AES-GCM",length:128},!0,n);case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r,a,c,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new TextEncoder,e.next=3,y(n,["encrypt"]);case 3:return a=e.sent,c=window.crypto.getRandomValues(new Uint8Array(12)),e.next=7,window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},a,r.encode(t));case 7:return o=e.sent,(i=new Uint8Array(c.length+o.byteLength)).set(c),i.set(new Uint8Array(o),c.length),e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r,a,c,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(n,["decrypt"]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.decrypt({name:"AES-GCM",iv:t.slice(0,12)},r,t.slice(12));case 5:return a=e.sent,c=new TextDecoder("utf-8"),o=c.decode(new Uint8Array(a)),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=function(e,t){return"".concat(e.slice(0,32)," ").concat(t)},j=function(e){return Number(e.split(" ")[1])},w=function(e){return j(e.peer)},C=function(e){try{var t=new URL(e).hash.slice(1);return new URLSearchParams(t).get("roomId")}catch(n){return null}},I=function(){var e=window.location.hash.slice(1),t=new URLSearchParams(e).get("server");try{var n=new URL(t||""),r="https:"===n.protocol,a=r?443:80;return{host:n.host.split(":")[0],port:n.port?Number(n.port):a,path:n.pathname,secure:r}}catch(c){}return null},S=(n(40),function(e,t){try{window.localStorage.setItem(e,t)}catch(n){console.info("Failed to save string to localStorage",n)}}),x=function(e){try{return window.localStorage.getItem(e)||""}catch(t){return""}},T=n(11),M=n(26),N=n.n(M),A=function(e){return new Promise((function(t){return setTimeout(t,e)}))},L=function(e){return"object"===typeof e&&null!==e},R=new WeakMap,U=function(e,t){if(R.has(e))return e;R.set(e,!0);var n=function(){var n=Object(v.a)(p.a.mark((function n(){var r;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,A(5e3);case 2:!(r=t.getTransceivers().find((function(t){return t.receiver.track===e})))||"inactive"!==r.currentDirection&&"sendonly"!==r.currentDirection||(e.stop(),e.dispatchEvent(new Event("ended")));case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return e.addEventListener("mute",n),e},D=function(e){var t=j(e);return 10<=t&&t<=14},P=function(e,t,n,r,a){var c=!1,o=null,i=null,u=function(){var e=new Map;return{addConn:function(t){var n=e.get(t.peer);n&&n.conn.close(),e.set(t.peer,{conn:t,mediaTypes:[]})},markConnected:function(t){var n=e.get(t.peer);n&&(n.connected=!0)},isConnected:function(t){var n=e.get(t);return n&&n.connected||!1},setUserId:function(t,n){var r=e.get(t.peer);r&&(r.userId=n)},getUserId:function(t){var n=e.get(t.peer);return n&&n.userId},setMediaTypes:function(t,n){var r=e.get(t.peer);r&&(r.mediaTypes=n)},getMediaTypes:function(t){var n=e.get(t.peer);return n&&n.mediaTypes||[]},hasConn:function(t){return e.has(t)},delConn:function(t){var n=e.get(t.peer);n&&n.conn===t&&e.delete(t.peer)},getConnectedPeerIds:function(){return Array.from(e.keys()).filter((function(t){var n;return null===(n=e.get(t))||void 0===n?void 0:n.connected}))},forEachConnectedConns:function(t){Array.from(e.values()).forEach((function(e){e.connected&&t(e.conn)}))},forEachConnsAcceptingMedia:function(t,n){Array.from(e.values()).forEach((function(e){e.connected&&e.mediaTypes&&e.mediaTypes.includes(t)&&n(e.conn)}))},clearAll:function(){e.size&&console.log("connectionMap garbage:",e),e.clear()}}}(),s=[],l=null,d=function(){if(!c){var e=u.getConnectedPeerIds().map(j);n({type:"CONNECTED_PEERS",peerIndexList:e})}},f=function(e){if(!c&&o&&o.id!==e&&!u.hasConn(e)){console.log("connectPeer",e);var t=o.connect(e);R(t)}},m=function(e,n){if(!c){n&&(i=e);var r=u.getConnectedPeerIds();u.forEachConnectedConns((function(n){M(n,{userId:t,data:e,peers:r,mediaTypes:s})}))}},b=function(e,t){M(e,{SDP:t})},g=function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r,a,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(n)){e.next=2;break}return e.abrupt("return");case 2:if(!L(n.offer)){e.next=21;break}return r=n.offer,e.prev=4,e.next=7,t.peerConnection.setRemoteDescription(r);case 7:return F(t),e.next=10,t.peerConnection.createAnswer();case 10:return a=e.sent,e.next=13,t.peerConnection.setLocalDescription(a);case 13:b(t,{answer:a}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),console.info("handleSDP offer failed",e.t0);case 19:e.next=38;break;case 21:if(!L(n.answer)){e.next=37;break}return c=n.answer,e.prev=23,e.next=26,t.peerConnection.setRemoteDescription(c);case 26:e.next=35;break;case 28:return e.prev=28,e.t1=e.catch(23),console.info("handleSDP answer failed",e.t1),e.next=33,A(30*Math.random()*1e3);case 33:W(t),F(t);case 35:e.next=38;break;case 37:console.warn("unknown SDP",n);case 38:case"end":return e.stop()}}),e,null,[[4,16],[23,28]])})));return function(t,n){return e.apply(this,arguments)}}(),y=function(e,t){"string"===typeof t&&u.setUserId(e,t)},C=function(){var e=Object(v.a)(p.a.mark((function e(t,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(n)||!n.every((function(e){return"string"===typeof e}))){e.next=5;break}return u.setMediaTypes(t,n),e.next=4,A(5e3);case 4:F(t);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),S=function(e,t){var n=u.getUserId(e);if(n){var a={userId:n,peerIndex:w(e),mediaTypes:u.getMediaTypes(e)};try{r(t,a)}catch(c){console.warn("receiveData",c)}}},x=function(){var t=Object(v.a)(p.a.mark((function t(n,r){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.t0=JSON,t.next=6,E(r,e.slice(32));case 6:if(t.t1=t.sent,a=t.t0.parse.call(t.t0,t.t1),console.log("decrypted payload",n.peer,a),L(a)){t.next=11;break}return t.abrupt("return");case 11:g(n,a.SDP),y(n,a.userId),C(n,a.mediaTypes),o=a.peers,Array.isArray(o)&&o.forEach((function(t){(function(e,t){return"string"===typeof t&&t.startsWith("".concat(e.slice(0,32)," "))})(e,t)&&f(t)})),S(n,a.data),t.next=21;break;case 18:t.prev=18,t.t2=t.catch(2),console.info("Error in handlePayload",t.t2,r);case 21:case"end":return t.stop()}var o}),t,null,[[2,18]])})));return function(e,n){return t.apply(this,arguments)}}(),M=function(){var t=Object(v.a)(p.a.mark((function t(n,r){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k(JSON.stringify(r),e.slice(32));case 3:a=t.sent,n.send(a),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("sendPayload",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}(),R=function(e){if(u.isConnected(e.peer))e.close();else{u.addConn(e),e.on("open",(function(){if(u.markConnected(e),console.log("dataConnection open",e),d(),i){var n=i,r=u.getConnectedPeerIds();M(e,{userId:t,data:n,peers:r,mediaTypes:s})}})),e.on("data",(function(t){return x(e,t)})),e.peerConnection.addEventListener("icegatheringstatechange",(function(){var t=e.peerConnection;"complete"===t.iceGatheringState&&(t.onicecandidate=function(){})}));var r=new WeakMap;e.peerConnection.addEventListener("negotiationneeded",Object(v.a)(p.a.mark((function t(){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.has(e)){t.next=2;break}return t.abrupt("return");case 2:return r.set(e,!0),t.next=5,A(2e3);case 5:if(r.delete(e),u.isConnected(e.peer)){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,e.peerConnection.createOffer();case 10:return n=t.sent,t.next=13,e.peerConnection.setLocalDescription(n);case 13:b(e,{offer:n});case 14:case"end":return t.stop()}}),t)})))),e.peerConnection.addEventListener("track",(function(t){var n=u.getUserId(e);if(n){var r={userId:n,peerIndex:j(e.peer),mediaTypes:u.getMediaTypes(e)};a(U(t.track,e.peerConnection),r)}})),e.on("close",(function(){if(u.delConn(e),console.log("dataConnection closed",e),n({type:"CONNECTION_CLOSED",peerIndex:w(e)}),d(),0===u.getConnectedPeerIds().length)_(!0);else if(D(e.peer)&&o&&!o.disconnected&&!D(o.id)){var t=30+Math.floor(60*Math.random());console.log("Disconnected seed peer: ".concat(j(e.peer),", reinit in ").concat(t,"sec...")),setTimeout(_,1e3*t)}}))}},P=function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;if(!c&&!o){u.clearAll();var a=10<=r&&r<=14,i=a?r:h();n({type:"INITIALIZING_PEER",peerIndex:i});var s=O(e,i);console.log("initMyPeer start",r,s);var l=new N.a(s,Object(T.a)({},I()||{},{debug:3}));o=l,l.on("open",(function(){o=l,n({type:"CONNECTING_SEED_PEERS"});for(var t=10;t<=14;t+=1){var r=O(e,t);f(r)}})),l.on("error",(function(e){"unavailable-id"===e.type?(o=null,l.destroy(),t(r+1)):"peer-unavailable"===e.type||("disconnected"===e.type?(console.log("initMyPeer disconnected error",r,e),l.destroy()):"network"===e.type?console.log("initMyPeer network error",r,e):"server-error"===e.type?(console.log("initMyPeer server error",r,e),n({type:"SERVER_ERROR"})):(console.error("initMyPeer unknown error",r,e.type,e),n({type:"UNKNOWN_ERROR",err:e})))})),l.on("connection",(function(e){o===l?(console.log("new connection received",e),n({type:"NEW_CONNECTION",peerIndex:w(e)}),R(e)):e.close()})),l.on("disconnected",(function(){console.log("initMyPeer disconnected",r),setTimeout((function(){o!==l||l.destroyed||(console.log("initMyPeer reconnecting",r),n({type:"RECONNECTING"}),l.reconnect())}),5e3)})),l.on("close",(function(){o===l?(console.log("initMyPeer closed, re-initializing",r),o=null,setTimeout(t,2e4)):console.log("initMyPeer closed, ignoring",r)}))}};P();var _=function(t){if(o&&!o.disconnected){if(!t){if(D(o.id))return;for(var n=!0,r=10;r<=14;r+=1){var a=O(e,r);if(!u.isConnected(a)){n=!1;break}}if(n)return void d()}var c=o;o=null,c.destroy(),P()}},V=new WeakMap,F=function(e){var t=e.peerConnection.getSenders(),n=u.getMediaTypes(e);l&&l.getTracks().forEach((function(r){var a=V.get(r);l&&a&&n.includes(a)&&t.every((function(e){return e.track!==r}))&&e.peerConnection.addTrack(r,l)})),t.forEach((function(t){if(t.track){var r=V.get(t.track);r&&n.includes(r)||e.peerConnection.removeTrack(t)}})),t.some((function(e){return e.track&&!e.transport}))&&e.peerConnection.dispatchEvent(new Event("negotiationneeded"))},W=function(e){e.peerConnection.getSenders().forEach((function(t){t.track&&e.peerConnection.removeTrack(t)}))};return{broadcastData:m,acceptMediaTypes:function(e){(s=e).length?l||(l=new MediaStream,u.forEachConnectedConns((function(e){var t=u.getUserId(e);if(t){var n={userId:t,peerIndex:j(e.peer),mediaTypes:u.getMediaTypes(e)};e.peerConnection.getReceivers().forEach((function(t){a(U(t.track,e.peerConnection),n)}))}}))):l=null,m(null)},addTrack:function(e,t){l&&(V.set(t,e),l.addTrack(t),u.forEachConnsAcceptingMedia(e,(function(e){try{if(!l)return;e.peerConnection.addTrack(t,l)}catch(n){if("InvalidAccessError"!==n.name)throw n}})))},removeTrack:function(e,t){l&&l.removeTrack(t),u.forEachConnsAcceptingMedia(e,(function(e){var n=e.peerConnection.getSenders().find((function(e){return e.track===t}));n&&e.peerConnection.removeTrack(n)}))},dispose:function(){c=!0,o&&o.destroy()}}},_=new Map,V=function(e,t,n,r,a){var c="".concat(e,"_").concat(t),o=_.get(c);if(!o){var i=new Set,u=new Set,s=new Set;o={room:P(e,t,(function(e){i.forEach((function(t){t(e)}))}),(function(e,t){u.forEach((function(n){n(e,t)}))}),(function(e,t){s.forEach((function(n){(0,n.listener)(e,t)}))})),networkStatusListeners:i,dataListeners:u,trackListeners:s,count:0},_.set(c,o)}if(n&&o.networkStatusListeners.add(n),r&&o.dataListeners.add(r),a){var l=new Set(Array.from(o.trackListeners).map((function(e){return e.mediaType}))),d=l.size;o.trackListeners.add(a),l.add(a.mediaType),d!==l.size&&o.room.acceptMediaTypes(Array.from(l))}o.count+=1;var f=o;return{broadcastData:o.room.broadcastData,addTrack:o.room.addTrack,removeTrack:o.room.removeTrack,unregister:function(){if(n&&f.networkStatusListeners.delete(n),r&&f.dataListeners.delete(r),a){var e=new Set(Array.from(f.trackListeners).map((function(e){return e.mediaType}))),t=e.size;f.trackListeners.delete(a),t!==(e=new Set(Array.from(f.trackListeners).map((function(e){return e.mediaType})))).size&&f.room.acceptMediaTypes(Array.from(e))}f.count-=1,f.count<=0&&(f.room.dispose(),_.delete(c))}}},F=function(e,t,n){var a=Object(r.useState)(),c=Object(d.a)(a,2),o=c[0],i=c[1];if(o&&"UNKNOWN_ERROR"===o.type)throw new Error("Network Error: ".concat(o.err.message));return Object(r.useEffect)((function(){return V(e,t,(function(e){i(e),n&&n(e)})).unregister}),[e,t,n]),o},W=function(e,t){var n=Object(r.useRef)(),a=Object(r.useCallback)((function(){n.current&&n.current.apply(n,arguments)}),[]);return Object(r.useEffect)((function(){var r=V(e,t);return n.current=r.broadcastData,r.unregister}),[e,t]),a},B=function(e,t,n){Object(r.useEffect)((function(){return V(e,t,void 0,n).unregister}),[e,t,n])},G=function(e,t,n,a){var c=Object(r.useState)({}),o=Object(d.a)(c,2),i=o[0],u=o[1];return Object(r.useEffect)((function(){if(a){var r=V(e,t,void 0,void 0,{mediaType:a,listener:n});return u({addTrack:function(e){return r.addTrack(a,e)},removeTrack:function(e){return r.removeTrack(a,e)}}),function(){u({}),r.unregister()}}}),[e,t,n,a]),i},q=[],H=function(e){var t={};return q.forEach((function(n){n.roomId===e&&(t[n.userId]=n.nickname)})),t},z=function(e,t){var n=Object(r.useState)((function(){return H(e)})),a=Object(d.a)(n,2),c=a[0],o=a[1];return B(e,t,Object(r.useCallback)((function(t,n){if(L(r=t)&&L(r.info)&&"string"===typeof r.info.nickname){var r,a=q.findIndex((function(t){return t.roomId===e&&t.userId===n.userId})),c=Date.now();a>=0?(q[a].nickname!==t.info.nickname&&(q[a].nickname=t.info.nickname),q[a].lastUpdated=c):q.push({roomId:e,userId:n.userId,nickname:t.info.nickname,lastUpdated:c});for(var i=q.length-1;i>=0;i-=1)q[i].lastUpdated+6e5<c&&q.splice(i,1);o((function(t){var n=H(e),r=Object.keys(n);return r.length===Object.keys(t).length&&r.every((function(e){return n[e]===t[e]}))?t:n}))}}),[e])),c},K=function(){var e=Object(v.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,n=t.filter((function(e){return"videoinput"===e.kind})).map((function(e){return{label:e.label,deviceId:e.deviceId}})),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(v.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,n=t.filter((function(e){return"audioinput"===e.kind})).map((function(e){return{label:e.label,deviceId:e.deviceId}})),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){Object(v.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))()}),[]),n},Z=(n(42),n(18)),Y=function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r,a,c,o,i,u,s,l,d,f,m;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof ImageCapture){e.next=21;break}return r=new ImageCapture(n),e.next=4,A(2e3);case 4:return e.prev=4,e.next=7,r.takePhoto();case 7:return c=e.sent,e.next=10,createImageBitmap(c);case 10:a=e.sent,e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(4),e.next=17,r.grabFrame();case 17:a=e.sent;case 18:return o=a.width,i=a.height,e.abrupt("return",{srcImg:a,srcW:o,srcH:i});case 21:return(u=document.getElementById("internal-video")).style.display="block",s=u.srcObject,l=function(){u.srcObject=s},u.srcObject=t,e.next=28,A(2e3);case 28:return d=u,f=u.videoWidth,m=u.videoHeight,e.abrupt("return",{srcImg:d,srcW:f,srcH:m,revert:l});case 32:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t,n){return e.apply(this,arguments)}}(),$=function(){var e=Object(v.a)(p.a.mark((function e(t){var n,r,a,c,o,i,u,s,l,f,m,v,b,h,g,y,k,E,O;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?{video:{deviceId:t}}:{video:!0},e.next=3,navigator.mediaDevices.getUserMedia(n);case 3:return r=e.sent,a=r.getVideoTracks(),c=Object(d.a)(a,1),o=c[0],i=document.getElementById("internal-canvas"),u=i.getContext("2d"),s=72,l=72,i.width=s,i.height=l,e.next=13,Y(r,o);case 13:return f=e.sent,m=f.srcImg,v=f.srcW,b=f.srcH,h=f.revert,g=Math.max(s/v,l/b),y=Math.min(v,s/g),k=Math.min(b,l/g),E=(v-y)/2,O=(b-k)/2,u.drawImage(m,E,O,y,k,0,0,s,l),h&&h(),o.stop(),e.abrupt("return",i.toDataURL("image/jpeg"));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(e){return L(e)&&"string"===typeof e.image&&function(e){return L(e)&&"string"===typeof e.nickname&&"string"===typeof e.message&&"boolean"===typeof e.liveMode}(e.info)},ee=n(13),te=n(29),ne=n(30),re=function(){var e=Object(v.a)(p.a.mark((function e(t){var n,r,a,c,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?{video:{deviceId:t}}:{video:!0},e.next=3,navigator.mediaDevices.getUserMedia(n);case 3:return r=e.sent,a=r.getVideoTracks(),c=Object(d.a)(a,1),o=c[0],i=function(){o.stop()},e.abrupt("return",{stream:r,dispose:i});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=Object(v.a)(p.a.mark((function e(t){var n,r,a,c,o,i,u,s,l,f,m,v,b,h,g,y,k,E;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?{video:{deviceId:t}}:{video:!0},e.next=3,navigator.mediaDevices.getUserMedia(n);case 3:return r=e.sent,a=r.getVideoTracks(),c=Object(d.a)(a,1),o=c[0],(i=document.getElementById("internal-video")).style.display="block",i.srcObject=r,e.next=10,A(1e3);case 10:return u=i.videoWidth,s=i.videoHeight,l=document.getElementById("internal-canvas"),f=l.getContext("2d"),72,72,l.width=72,l.height=72,m=Math.max(72/u,72/s),v=Math.min(u,72/m),b=Math.min(s,72/m),h=(u-v)/2,g=(s-b)/2,function e(){f.drawImage(i,h,g,v,b,0,0,72,72),y=setTimeout(e,1e3/15)}(),k=l.captureStream(),E=function(){i.style.display="none",clearTimeout(y),o.stop(),k.getVideoTracks()[0].stop()},e.abrupt("return",{stream:k,dispose:E});case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=Object(v.a)(p.a.mark((function e(t){var n,r,a,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,(n=document.createElement("video")).srcObject=new MediaStream([t]),r=0;case 4:if(!(r<50)){e.next=14;break}return e.next=7,A(100);case 7:if(a=n.videoWidth,c=n.videoHeight,!(a>0&&c>0)){e.next=11;break}return e.abrupt("return",72===a&&72===c);case 11:r+=1,e.next=4;break;case 14:return e.abrupt("return",!0);case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}(),oe=new WeakMap,ie=function(e){if(oe.has(e))return oe.get(e);var t=ce(e);return oe.set(e,t),t},ue=function(){var e=Object(v.a)(p.a.mark((function e(t){var n,r,a,c,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?{audio:{deviceId:t}}:{audio:!0},e.next=3,navigator.mediaDevices.getUserMedia(n);case 3:return r=e.sent,a=r.getAudioTracks(),c=Object(d.a)(a,1),o=c[0],e.next=7,o.applyConstraints({echoCancellation:!0,echoCancellationType:{ideal:"system"},noiseSuppression:{ideal:!0}});case 7:return i=function(){o.stop()},e.abrupt("return",{stream:r,dispose:i});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=function(e,t,n){var r=t||new MediaStream;return r.addTrack(e),r.dispatchEvent(new MediaStreamTrackEvent("addtrack",{track:e})),e.addEventListener("ended",(function(){r.removeTrack(e),0===r.getTracks().length&&n()})),r},le=a.a.memo((function(e){var t=e.image,n=e.nickname,r=e.statusMesg,c=e.obsoleted,o=e.liveMode,i=e.stream,u=e.speakerOn;return a.a.createElement("div",{className:"FaceImages-card",style:{opacity:c?.2:1}},o&&!c&&i?a.a.createElement("video",{className:"FaceImages-photo",ref:function(e){e&&e.srcObject!==i&&(e.srcObject=i)},autoPlay:!0,playsInline:!0,muted:!u}):a.a.createElement("img",{src:t||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQI12NgYAAAAAMAASDVlMcAAAAASUVORK5CYII=",className:"FaceImages-photo",alt:"myself"}),a.a.createElement("div",{className:"FaceImages-name"},n),a.a.createElement("div",{className:"FaceImages-mesg"},r),o&&!c&&i&&a.a.createElement("div",{className:"FaceImages-live-indicator",title:"Live Mode On"},"\u25c9"),o&&!c&&!i&&a.a.createElement("div",{className:"FaceImages-live-indicator",title:"Live Mode Available"},"\u25ce"))})),de=a.a.memo((function(e){var t=e.roomId,n=e.userId,c=e.nickname,o=e.statusMesg,i=e.liveMode,u=e.micOn,s=e.speakerOn,l=e.videoDeviceId,f=e.audioDeviceId,m=function(e,t,n,a,c,o){var i=Object(r.useState)(),u=Object(d.a)(i,2),s=u[0],l=u[1],f=Object(r.useState)([]),m=Object(d.a)(f,2),b=m[0],h=m[1],g=Object(r.useState)(),y=Object(d.a)(g,2),k=y[0],E=y[1];if(k)throw k;var O=W(e,t);return B(e,t,Object(r.useCallback)((function(e,t){if(X(e)){var n=Object(T.a)({},e,{userId:t.userId,received:Date.now(),obsoleted:!1,peerIndex:t.peerIndex});h((function(e){return e.find((function(e){return e.userId===n.userId}))?e.map((function(e){return e.userId===n.userId?n:e})):[].concat(Object(Z.a)(e),[n])}))}}),[])),F(e,t,Object(r.useCallback)((function(e){if(e&&"CONNECTION_CLOSED"===e.type){var t=e.peerIndex;h((function(e){var n=!1,r=e.map((function(e){return e.peerIndex===t?(n=!0,Object(T.a)({},e,{obsoleted:!0})):e}));return n?r:e}))}}),[])),Object(r.useEffect)((function(){var e,t=function(){var e=Date.now()-12e4,t=Date.now()-6e5;h((function(n){var r=!1,a=n.map((function(n){return n.received<e&&!n.obsoleted?(r=!0,Object(T.a)({},n,{obsoleted:!0})):n.received<t&&n.obsoleted?(r=!0,null):n})).filter((function(e){return e}));return r?a:n}))},r=function(){var i=Object(v.a)(p.a.mark((function i(){var u;return p.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,t(),i.next=4,$(o);case 4:u=i.sent,l(u),O({image:u,info:{nickname:n,message:a,liveMode:c}},!0),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(0),E(i.t0);case 14:e=setTimeout(r,12e4);case 15:case"end":return i.stop()}}),i,null,[[0,11]])})));return function(){return i.apply(this,arguments)}}();return r(),function(){clearTimeout(e)}}),[e,t,o,n,a,c,O]),{myImage:s,roomImages:b}}(t,n,c,o,i,l),b=m.myImage,h=m.roomImages,g=function(e,t,n,a,c,o,i){var u=Object(r.useState)(null),s=Object(d.a)(u,2),l=s[0],f=s[1],m=Object(r.useState)({}),b=Object(d.a)(m,2),h=b[0],g=b[1],y=Object(r.useRef)(!0);Object(r.useEffect)((function(){y.current=!1}),[]);var k=Object(r.useCallback)(function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="video"===t.kind,!e.t0){e.next=5;break}return e.next=4,ie(t);case 4:e.t0=!e.sent;case 5:if(!e.t0){e.next=7;break}return e.abrupt("return");case 7:r=function(){y.current&&g((function(e){var t=n.userId;e[t];return Object(te.a)(e,[t].map(ne.a))}))},g((function(e){var a=e[n.userId],c=se(t,a,r);return a===c?e:Object(T.a)({},e,Object(ee.a)({},n.userId,c))}));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),E=G(e,t,k,n?"faceVideo":void 0),O=E.addTrack,j=E.removeTrack,w=G(e,t,k,a?"faceAudio":void 0),C=w.addTrack,I=w.removeTrack;return Object(r.useEffect)((function(){var e=null;return n&&O&&j&&Object(v.a)(p.a.mark((function t(){var n,r,a,c,i,u,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ae(o);case 2:n=t.sent,r=n.stream,a=n.dispose,c=r.getVideoTracks(),i=Object(d.a)(c,1),u=i[0],O(u),s=function(){y.current&&f(null)},f((function(e){return se(u,e,s)})),e=function(){j(u),a(),u.dispatchEvent(new Event("ended"))};case 10:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,n,o,O,j]),Object(r.useEffect)((function(){var e=null;return a&&C&&I&&Object(v.a)(p.a.mark((function t(){var n,r,a,c,o,u,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ue(i);case 2:n=t.sent,r=n.stream,a=n.dispose,c=r.getAudioTracks(),o=Object(d.a)(c,1),u=o[0],C(u),s=function(){y.current&&f(null)},f((function(e){return se(u,e,s)})),e=function(){I(u),a(),u.dispatchEvent(new Event("ended"))};case 10:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,a,i,C,I]),Object(r.useEffect)((function(){if(l){l.getAudioTracks().forEach((function(e){e.enabled=c}));var e=function(e){var t=e.track;"audio"===t.kind&&(t.enabled=c)};return l.addEventListener("addtrack",e),function(){l.removeEventListener("addtrack",e)}}}),[l,c]),{faceStream:l,faceStreamMap:h}}(t,n,i,i,u,l,f),y=g.faceStream,k=g.faceStreamMap;return a.a.createElement("div",{className:"FaceImage-container"},a.a.createElement(le,{image:b,nickname:c,statusMesg:o,liveMode:i,stream:y||void 0}),h.map((function(e){return a.a.createElement(le,{key:e.userId,image:e.image,nickname:e.info.nickname,statusMesg:e.info.message,obsoleted:e.obsoleted,liveMode:e.info.liveMode,stream:i&&k[e.userId]||void 0,speakerOn:s})})))})),fe=(n(43),function(e,t){var n=t[1]-e[1];return 0===n?e[0].length-t[0].length:n}),me=function(e,t,n){var a=Object(r.useRef)(1),c=Object(r.useRef)(new Map),o=Object(r.useState)([]),i=Object(d.a)(o,2),u=i[0],s=i[1],l=Object(r.useCallback)((function(e){if((c.current.get(e.userId)||0)<e.chatSeq)if(c.current.set(e.userId,e.chatSeq),e.chatInReplyTo){var t=e.chatText,n=e.chatInReplyTo;s((function(e){return e.map((function(e){if(e.replyTo.userId===n.userId&&e.replyTo.chatSeq===n.chatSeq){var r=new Map(e.replies);r.set(t,(r.get(t)||0)+1);var a=Object(Z.a)(r.entries());return a.sort(fe),Object(T.a)({},e,{replies:a})}return e}))}))}else{var r=new Date,a={key:"".concat(e.userId,"_").concat(e.chatSeq),replyTo:{userId:e.userId,chatSeq:e.chatSeq},nickname:e.nickname,text:e.chatText,replies:[],time:r.toLocaleString().split(" ")[1].slice(0,-3)};s((function(e){return[a].concat(Object(Z.a)(e)).slice(0,100)}))}}),[]),f=W(e,t);return B(e,t,Object(r.useCallback)((function(e){var t;!L(t=e)||"string"!==typeof t.userId||"string"!==typeof t.nickname||"number"!==typeof t.chatSeq||"string"!==typeof t.chatText||"undefined"!==typeof t.chatInReplyTo&&"string"!==typeof t.chatInReplyTo.userId&&"number"!==typeof t.chatInReplyTo.chatSeq||l(e)}),[l])),{chatList:u,sendChat:Object(r.useCallback)((function(e){var r={userId:t,nickname:n,chatSeq:a.current,chatText:e};a.current+=1,f(r),l(r)}),[f,t,n,l]),replyChat:Object(r.useCallback)((function(e,r){var c={userId:t,nickname:n,chatSeq:a.current,chatText:e,chatInReplyTo:r};a.current+=1,f(c),l(c)}),[f,t,n,l])}},pe=(n(44),n(19)),ve=pe.b,be=a.a.memo((function(e){var t=e.item,n=e.replyChat,c=Object(r.useState)(!1),o=Object(d.a)(c,2),i=o[0],u=o[1],s=function(e){return n(e,t.replyTo)};return a.a.createElement("li",{key:t.key,className:"MomentaryChat-listPart"},i&&a.a.createElement(ve,{onSelect:function(e){s(e.native),u(!1)}}),a.a.createElement("div",{className:"MomentaryChat-listPart-header"},a.a.createElement("div",{className:"MomentaryChat-iconButton-container"},a.a.createElement("div",{className:"MomentaryChat-iconButton"},a.a.createElement("button",{type:"button",onClick:function(){u(!i)}},"+"))),a.a.createElement("span",{className:"MomentaryChat-nickname"},t.nickname||"No Name"),a.a.createElement("span",{className:"MomentaryChat-time"},t.time)),a.a.createElement("div",null,t.text),t.replies.map((function(e){var t=Object(d.a)(e,2),n=t[0],r=t[1];return a.a.createElement("button",{key:n,className:"MomentaryChat-icon",type:"button",onClick:function(){return s(n)}},n," ",r)})))})),he=a.a.memo((function(e){var t=e.chatList,n=e.replyChat,c=e.onUpdateLayout,o=Object(r.useRef)(null);return Object(r.useLayoutEffect)((function(){o.current&&c(o.current.scrollHeight)})),a.a.createElement("ul",{className:"MomentaryChat-list",ref:o},t.map((function(e){return a.a.createElement(be,{key:e.key,item:e,replyChat:n})})))})),ge=a.a.memo((function(e){var t=e.roomId,n=e.userId,c=e.nickname,o=Object(r.useRef)(null),i=me(t,n,c),u=i.chatList,s=i.sendChat,l=i.replyChat,f=Object(r.useState)(""),m=Object(d.a)(f,2),p=m[0],v=m[1];return a.a.createElement("div",{className:"MomentaryChat-container",ref:o},a.a.createElement(he,{chatList:u,replyChat:l,onUpdateLayout:function(e){o.current&&(o.current.scrollTop=e)}}),a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),p&&(s(p),v(""))}},a.a.createElement("div",{className:"MomentaryChat-message-input-area"},a.a.createElement("input",{value:p,onChange:function(e){return v(e.target.value)},placeholder:"Enter chat message"}),a.a.createElement("button",{type:"submit",disabled:!p},"Send"))))})),ye=(n(48),function(){var e=Object(v.a)(p.a.mark((function e(){var t,n,r,a,c,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={video:!0},e.next=4,navigator.mediaDevices.getDisplayMedia(t);case 4:return n=e.sent,r=n.getVideoTracks(),a=Object(d.a)(r,1),c=a[0],o=function(){c.stop()},e.abrupt("return",{stream:n,dispose:o});case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}()),ke=function(){var e=Object(v.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("video"===t.kind){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,ie(t);case 4:return n=e.sent,e.abrupt("return",!n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ee=a.a.memo((function(e){var t=e.nickname,n=e.stream,c=Object(r.useRef)(null);return Object(r.useEffect)((function(){n&&c.current&&(c.current.srcObject=n)}),[n]),a.a.createElement("div",null,a.a.createElement("div",{className:"ScreenShare-nickname"},t),a.a.createElement("video",{className:"ScreenShare-video",ref:c,autoPlay:!0,muted:!0}))})),Oe=a.a.memo((function(e){var t=e.roomId,n=e.userId,c=e.nickname,o=Object(r.useState)(!1),i=Object(d.a)(o,2),u=i[0],s=i[1],l=function(e,t,n,a){var c=Object(r.useState)(null),o=Object(d.a)(c,2),i=o[0],u=o[1],s=Object(r.useState)({}),l=Object(d.a)(s,2),f=l[0],m=l[1],b=Object(r.useRef)([]);Object(r.useEffect)((function(){return function(){b.current.forEach((function(e){return e()}))}}),[]);var h=Object(r.useCallback)(function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke(t);case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:m((function(e){return Object(T.a)({},e,Object(ee.a)({},n.userId,new MediaStream([t])))})),r=function(){m((function(e){return Object(T.a)({},e,Object(ee.a)({},n.userId,null))}))},t.addEventListener("ended",r),b.current.push((function(){t.removeEventListener("ended",r)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),g=G(e,t,h,"screenVideo"),y=g.addTrack,k=g.removeTrack;return Object(r.useEffect)((function(){var e=null;return n&&y&&k&&Object(v.a)(p.a.mark((function t(){var n,r,c,o;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ye();case 2:if(n=t.sent){t.next=6;break}return a(!1),t.abrupt("return");case 6:r=n.stream.getVideoTracks(),c=Object(d.a)(r,1),o=c[0],y(o),u(n.stream),e=function(){k(o),n.dispose(),u(null),a(!1)},o.addEventListener("ended",(function(){e&&e(),e=null}));case 11:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,n,a,y,k]),{screenStream:i,screenStreamMap:f}}(t,n,u,s),f=l.screenStream,m=l.screenStreamMap,b=z(t,n);return a.a.createElement("div",{className:"ScreenShare-container"},a.a.createElement("button",{type:"button",onClick:function(){return s(!u)}},u?"Stop screen share":"Start screen share"),f&&a.a.createElement(Ee,{nickname:c,stream:f}),Object.keys(m).map((function(e){var t=m[e];return t?a.a.createElement(Ee,{key:e,nickname:b[e]||"No Name",stream:t}):null})))})),je=(n(49),function(){var e=Object(v.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("video"===t.kind){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,ie(t);case 4:return n=e.sent,e.abrupt("return",!n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),we=a.a.memo((function(e){var t=e.nickname,n=e.stream,c=Object(r.useRef)(null);return Object(r.useEffect)((function(){n&&c.current&&(c.current.srcObject=n)}),[n]),a.a.createElement("div",null,a.a.createElement("div",{className:"VideoShare-nickname"},t),a.a.createElement("video",{className:"VideoShare-video",ref:c,autoPlay:!0,muted:!0}))})),Ce=a.a.memo((function(e){var t=e.roomId,n=e.userId,c=e.nickname,o=Q(),i=Object(r.useState)(),u=Object(d.a)(i,2),s=u[0],l=u[1],f=Object(r.useState)(!1),m=Object(d.a)(f,2),b=m[0],h=m[1],g=function(e,t,n,a,c){var o=Object(r.useState)(null),i=Object(d.a)(o,2),u=i[0],s=i[1],l=Object(r.useState)({}),f=Object(d.a)(l,2),m=f[0],b=f[1],h=Object(r.useRef)([]);Object(r.useEffect)((function(){return function(){h.current.forEach((function(e){return e()}))}}),[]);var g=Object(r.useCallback)(function(){var e=Object(v.a)(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je(t);case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:b((function(e){return Object(T.a)({},e,Object(ee.a)({},n.userId,new MediaStream([t])))})),r=function(){b((function(e){return Object(T.a)({},e,Object(ee.a)({},n.userId,null))}))},t.addEventListener("ended",r),h.current.push((function(){t.removeEventListener("ended",r)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),y=G(e,t,g,"cameraVideo"),k=y.addTrack,E=y.removeTrack;return Object(r.useEffect)((function(){var e=null;return n&&k&&E&&Object(v.a)(p.a.mark((function t(){var n,r,o,i;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,re(c);case 2:n=t.sent,r=n.stream.getVideoTracks(),o=Object(d.a)(r,1),i=o[0],k(i),s(n.stream),e=function(){E(i),n.dispose(),s(null),a(!1)},i.addEventListener("ended",(function(){e&&e(),e=null}));case 8:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,c,n,a,k,E]),{videoStream:u,videoStreamMap:m}}(t,n,b,h,s),y=g.videoStream,k=g.videoStreamMap,E=z(t,n),O=(y?1:0)+Object.values(k).filter((function(e){return e})).length;return a.a.createElement("div",{className:"VideoShare-container"},a.a.createElement("div",null,"Select Camera:"," ",a.a.createElement("select",{value:s,onChange:function(e){return l(e.target.value)}},o.map((function(e){return a.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),a.a.createElement("button",{type:"button",onClick:function(){return h(!b)}},b?"Stop video share":"Start video share"),a.a.createElement("div",{className:"VideoShare-body",style:{gridTemplateColumns:"repeat(".concat(Math.ceil(Math.sqrt(O)),", 1fr)")}},y&&a.a.createElement(we,{nickname:c,stream:y}),Object.keys(k).map((function(e){var t=k[e];return t?a.a.createElement(we,{key:e,nickname:E[e]||"No Name",stream:t}):null}))))})),Ie=(n(50),function(){var e=Object(v.a)(p.a.mark((function e(t){var n,r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.slice(0,20),e.next=3,y(t.slice(32),["encrypt","decrypt"]);case 3:return r=e.sent,e.next=6,window.crypto.subtle.exportKey("jwk",r);case 6:return a=e.sent.k,e.abrupt("return","https://excalidraw.com/#room=".concat(n,",").concat(a));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Se=a.a.memo((function(e){var t=e.roomId,n=Object(r.useState)(),c=Object(d.a)(n,2),o=c[0],i=c[1];return Object(r.useEffect)((function(){Object(v.a)(p.a.mark((function e(){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ie(t);case 2:n=e.sent,i(n);case 4:case"end":return e.stop()}}),e)})))()}),[t]),a.a.createElement("div",{className:"CollabWhiteBoard-container"},o&&a.a.createElement("iframe",{title:"Excalidraw",src:o}))})),xe=(n(51),a.a.memo((function(e){var t=e.initialText,n=e.onUpdate,c=e.buttonLabel,o=e.placeholder,i=e.clearOnUpdate,u=Object(r.useState)(t),s=Object(d.a)(u,2),l=s[0],f=s[1];return a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),l&&(n(l),i&&f(""))}},a.a.createElement("input",{value:l,onChange:function(e){return f(e.target.value)},placeholder:o}),c&&a.a.createElement("button",{type:"submit",disabled:!l},c))}))),Te=a.a.memo((function(e){var t=e.initialNickname,n=e.emoji,c=e.onUpdateNickname,o=e.onUpdateStatusMesg,i=e.onUpdateEmoji,u=Object(r.useState)(!1),s=Object(d.a)(u,2),l=s[0],f=s[1];return a.a.createElement("div",{className:"UserProfile-container"},a.a.createElement("div",{className:"UserProfile-nickname"},a.a.createElement(xe,{initialText:t,onUpdate:c,placeholder:"Enter your name",buttonLabel:"Set"})),a.a.createElement("div",{className:"UserProfile-status-area"},a.a.createElement("div",{className:"UserProfile-emoji"},a.a.createElement("button",{type:"button",onClick:function(){f(!l)}},n?a.a.createElement(pe.a,{emoji:n,size:10}):":)")),a.a.createElement("div",{className:"UserProfile-statusmesg"},a.a.createElement(xe,{initialText:"",onUpdate:o,placeholder:"Enter status message",buttonLabel:"Set"})),a.a.createElement("button",{type:"button",onClick:function(){i(null),o(""),f(!1)}},"Clear")),l&&a.a.createElement(ve,{onSelect:function(e){i(e),f(!1)}}))})),Me=x("nickname"),Ne="true"!==x("config_hidden"),Ae=x("faceimage_video_device_id"),Le=x("faceimage_audio_device_id"),Re=a.a.memo((function(e){var t=e.roomId,n=e.userId,c=Object(r.useState)(Me),o=Object(d.a)(c,2),i=o[0],u=o[1],s=Object(r.useState)(""),l=Object(d.a)(s,2),f=l[0],m=l[1],b=Object(r.useState)(null),h=Object(d.a)(b,2),g=h[0],y=h[1];Object(r.useEffect)((function(){!function(e){var t=window.location.hash.slice(1),n=new URLSearchParams(t);n.set("roomId",e),window.location.hash=n.toString()}(t)}),[t]);var k=Q(),E=function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){Object(v.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))()}),[]),n}(),O=Object(r.useState)(Ae),j=Object(d.a)(O,2),w=j[0],C=j[1],I=Object(r.useState)(Le),x=Object(d.a)(I,2),T=x[0],M=x[1],N=Object(r.useState)(!1),A=Object(d.a)(N,2),L=A[0],R=A[1],U=Object(r.useState)(!1),D=Object(d.a)(U,2),P=D[0],_=D[1],V=Object(r.useState)(!1),W=Object(d.a)(V,2),B=W[0],G=W[1],q=Object(r.useState)(!1),H=Object(d.a)(q,2),K=H[0],Z=H[1],Y=Object(r.useState)(!1),$=Object(d.a)(Y,2),X=$[0],ee=$[1],te=Object(r.useState)(!1),ne=Object(d.a)(te,2),re=ne[0],ae=ne[1],ce=Object(r.useState)(Ne),oe=Object(d.a)(ce,2),ie=oe[0],ue=oe[1];Object(r.useEffect)((function(){S("config_hidden",ie?"false":"true")}),[ie]);var se=F(t,n);z(t,n);var le="remote-faces://".concat(window.location.href.replace(/^https:\/\//,""));return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"SingleRoom-body"},a.a.createElement(de,{roomId:t,userId:n,videoDeviceId:w,audioDeviceId:T,nickname:i,statusMesg:"".concat((null===g||void 0===g?void 0:g.native)||"").concat(f),liveMode:L,micOn:P,speakerOn:B}),a.a.createElement("div",{className:"SingleRoom-2nd-column"},a.a.createElement(Te,{initialNickname:Me,emoji:g,onUpdateNickname:function(e){u(e),S("nickname",e)},onUpdateStatusMesg:function(e){m(e)},onUpdateEmoji:function(e){y(e)}}),a.a.createElement("div",null,a.a.createElement("button",{type:"button",className:"SingleRoom-config-toggle",onClick:function(){return ue((function(e){return!e}))}},"Setting",ie?a.a.createElement(a.a.Fragment,null,"\u25bc"):a.a.createElement(a.a.Fragment,null,"\u25b6")),ie&&a.a.createElement("div",{className:"SingleRoom-config"},a.a.createElement("div",null,"Link to this room:",a.a.createElement("input",{value:window.location.href,readOnly:!0}),"(Share this link with your colleagues)",a.a.createElement("a",{href:le},"Open App")),a.a.createElement("div",null,"Select Camera:"," ",a.a.createElement("select",{value:w,onChange:function(e){C(e.target.value),S("faceimage_video_device_id",e.target.value)}},k.map((function(e){return a.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),a.a.createElement("div",null,"Select Mic:"," ",a.a.createElement("select",{value:T,onChange:function(e){M(e.target.value),S("faceimage_audio_device_id",e.target.value)}},E.map((function(e){return a.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),a.a.createElement("div",null,"Live Mode:"," ",a.a.createElement("button",{type:"button",onClick:function(){return R((function(e){return!e}))}},L?"Disable":"Enable"),L&&a.a.createElement(a.a.Fragment,null,"\u2714"),L&&a.a.createElement("div",null,a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",checked:P,onChange:function(e){return _(e.target.checked)}}),"Mic On"),a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",checked:B,onChange:function(e){return G(e.target.checked)}}),"Speaker On"))),a.a.createElement("div",null,"Screen Share:"," ",a.a.createElement("button",{type:"button",onClick:function(){return Z((function(e){return!e}))}},K?"Close":"Open"),K&&a.a.createElement(a.a.Fragment,null,"\u2714")),a.a.createElement("div",null,"Video Share:"," ",a.a.createElement("button",{type:"button",onClick:function(){return ee((function(e){return!e}))}},X?"Close":"Open"),X&&a.a.createElement(a.a.Fragment,null,"\u2714")),a.a.createElement("div",null,"Collab White Board:"," ",a.a.createElement("button",{type:"button",onClick:function(){return ae((function(e){return!e}))}},re?"Close":"Open"),re&&a.a.createElement(a.a.Fragment,null,"\u2714")),a.a.createElement("div",{className:"SingleRoom-status"},JSON.stringify(se)))),a.a.createElement(ge,{roomId:t,userId:n,nickname:i})),a.a.createElement("div",{className:"SingleRoom-3rd-column"},K&&a.a.createElement(Oe,{roomId:t,userId:n,nickname:i}),X&&a.a.createElement(Ce,{roomId:t,userId:n,nickname:i}),re&&a.a.createElement(Se,{roomId:t}))))})),Ue=function(){var e=window.location.hash.slice(1);return new URLSearchParams(e).get("roomId")}(),De=b(),Pe=a.a.memo((function(){var e=Object(r.useState)(Ue),t=Object(d.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(""),i=Object(d.a)(o,2),u=i[0],s=i[1],l=function(){var e=Object(v.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.t1=b(16),e.next=4,g();case 4:e.t2=e.sent,e.t3=e.t1+e.t2,(0,e.t0)(e.t3);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n?a.a.createElement(Re,{roomId:n,userId:De}):a.a.createElement("div",{className:"SingleRoomEntrance-init"},a.a.createElement("button",{type:"button",onClick:l},"Create a new room"),"OR",a.a.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},placeholder:"Enter room link..."}),a.a.createElement("button",{type:"button",onClick:function(){c(C(u))},disabled:!C(u)},"Enter room"))})),_e=(n(52),a.a.memo((function(e){var t=e.size,n=e.fill,r=e.color;return a.a.createElement("a",{href:"https://github.com/dai-shi/remote-faces",className:"GitHubCorner-container","aria-label":"View source on GitHub",target:"_blank",rel:"noopener noreferrer"},a.a.createElement("svg",{width:t||80,height:t||80,viewBox:"0 0 250 250",style:{fill:n||"#151513",color:r||"#fff",position:"absolute",top:0,border:0,right:0},"aria-hidden":"true"},a.a.createElement("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),a.a.createElement("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"GitHubCorner-octo-arm"}),a.a.createElement("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"GitHubCorner-octo-body"})))}))),Ve=function(e){Object(l.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state={},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.children,t=this.state.err;return t?a.a.createElement(f,{err:t}):e}}],[{key:"getDerivedStateFromError",value:function(e){return{err:e}}}]),n}(a.a.PureComponent),Fe=a.a.memo((function(){return a.a.createElement("div",{className:"App"},a.a.createElement(Ve,null,a.a.createElement(Pe,null),a.a.createElement(_e,{size:40,fill:"gray"})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Fe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.adff9308.chunk.js.map